let objQtd={total:0,unknown:0,undefined:0,proceeds:0,notProceeds:0,correction:0,notCorrection:0},objValue={valueTotal:0,proceeds:0,notProceeds:0,correction:0,notCorrection:0};document.addEventListener("alpine:init",(()=>{Alpine.data("managerFrm",(()=>({modalStatus:new bootstrap.Modal(document.getElementById("modal-status")),data:{_token:document.head.querySelector("meta[name=csrf-token]").content},rows:{},qtdAll:{...objQtd},valueAll:{...objValue},loading:!1,buttonLabel:"Visualizar",setModalStatus(t,e){document.getElementById("title-modal-status").innerText=t,document.getElementById("desc-status-modal").innerText=e},sumColumn(t,e,o){let n=arrayColumn(t,e);return"int"==o?n.reduce(((t,e)=>t+(null==e?0:parseInt(e))),0):"float"==o?n.reduce(((t,e)=>t+(null==e?0:parseFloat(e))),0):0},async getList(){this.rows={},this.qtdAll={...objQtd},this.valueAll={...objValue};let t=document.getElementById("route_list").value,e=await this.requestGet(t,"Lista");this.rows=e.data,this.feedsTbody(this.rows),this.qtdAll.total=this.sumColumn(e.data,"count_total","int"),this.qtdAll.unknown=this.sumColumn(e.data,"count_total_unknown","int"),this.qtdAll.undefined=this.sumColumn(e.data,"count_undefined","int"),this.qtdAll.proceeds=this.sumColumn(e.data,"count_proceeds","int"),this.qtdAll.notProceeds=this.sumColumn(e.data,"count_not_proceeds","int"),this.qtdAll.correction=this.sumColumn(e.data,"count_correction","int"),this.qtdAll.notCorrection=this.sumColumn(e.data,"count_not_correction","int"),this.valueAll.valueTotal=this.sumColumn(e.data,"value_total","float").toFixed(2),this.valueAll.proceeds=this.sumColumn(e.data,"value_proceeds","float").toFixed(2),this.valueAll.notProceeds=this.sumColumn(e.data,"value_not_proceeds","float").toFixed(2),this.valueAll.correction=this.sumColumn(e.data,"value_correction","float").toFixed(2),this.valueAll.notCorrection=this.sumColumn(e.data,"value_not_correction","float").toFixed(2),this.feedsTfoot(this.qtdAll,this.valueAll)},async exportReport(){if($("#frm").valid()){let t=document.getElementById("route_export").value;await this.requestGet(t,"Exportação"),this.setModalStatus("Poof!","Em instante chegará na sua caixa de entrada."),this.modalStatus.show()}},async requestGet(t,e){this.loading=!0;let o=document.getElementById("start_date").value.split("/").reverse().join("-"),n=document.getElementById("end_date").value.split("/").reverse().join("-");const l=await fetch(t+"/"+o+"/"+n);if(!l.ok){this.loading=!1,this.setModalStatus(`Algo errado! ${e}`,"Se persistir, fale com o administrador!"),this.modalStatus.show();const t=`An error has occured: ${l.status}`;throw new Error(t)}const a=await l.json();return this.loading=!1,$((function(){$('[data-toggle="tooltip"]').tooltip()})),a},removeNull:t=>Boolean(t)?t:"",feedsTbody(t){let e=document.getElementById("result-tbody");e.innerHTML="",t.forEach((t=>{let o=Boolean(t.name)?t.name:"",n=`${t.batch_date.substr(8,2)}/${t.batch_date.substr(5,2)}/${t.batch_date.substr(2,2)}`;e.insertRow().innerHTML=`\n                            <td data-toggle="tooltip" data-placement="top" title="${o}"><span>${n}</span></td>\n                            <td>${this.removeNull(t.count_total)}</td>\n                            <td>${this.removeNull(this.moneyBR(t.value_total).substr(3))}</td>\n                            <td>${this.removeNull(t.count_undefined)}</td>\n                            <td>${this.removeNull(t.count_proceeds)}</td>\n                            <td>${this.removeNull(this.moneyBR(t.value_proceeds).substr(3))}</td>\n                            <td>${this.removeNull(t.count_not_proceeds)}</td>\n                            <td>${this.removeNull(this.moneyBR(t.value_not_proceeds).substr(3))}</td>\n                            `})),0==t.length&&(e.innerHTML='<tr><td colspan="10" class="text-center"><b>Nenhum registro encontrado</b></td></tr>')},feedsTfoot(t,e){tfoot=document.getElementById("result-tfoot"),tr=`<tr class="table-secondary">\n                            <td data-toggle="tooltip" data-placement="top" title="Quantidade total" scope="col"><b>Q. Total</b></td>\n                            <td>${t.total}</td>\n                            <td>${this.moneyBR(e.valueTotal).substr(3)}</td>\n                            <td>${t.undefined}</td>\n                            <td>${t.proceeds}</td>\n                            <td>${this.moneyBR(e.proceeds).substr(3)}</td>\n                            <td>${t.notProceeds}</td>\n                            <td>${this.moneyBR(e.notProceeds).substr(3)}</td>\n                        </tr>`,tfoot.innerHTML=tr},moneyBR:t=>null==t?"":parseFloat(t).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}).toString(),submitData(){$("#frm").valid()&&this.getList()}})))}));
