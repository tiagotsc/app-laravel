let permissionDestroy=$("#allow_del_batch").val();var table=$("#list").DataTable({pageLength:50,responsive:!0,autoWidth:!1,language:{url:"/assets/plugins/datatables/pt_br.json",select:{rows:{_:"Você selecionou %d linhas",0:"Clique na linha para selecionar",1:"Apenas 1 linha foi selecionada"}},buttons:{copyTitle:"Tabela copiada",copySuccess:{_:"%d linhas copiadas",1:"1 linha copiada"}}},order:[[1,"desc"]],searching:!0,ajax:$("#route_list").val(),initComplete:function(t,e){$((function(){$('[data-toggle="tooltip"]').tooltip()}))},columns:[{class:"details-control",orderable:!1,data:null,defaultContent:"",width:"2%"},{data:"id",width:"4%"},{data:"name",width:"8%",orderable:!1,render:function(t,e,a){return`${a.name.substr(12,10)}`}},{data:"count_total",width:"6%",render:function(t,e,a){return a.count_total+` <b class="text-info" data-toggle="tooltip" data-placement="top" title="${a.count_detail_total} registros em detalhes"><i class="bi bi-info-circle-fill"></i></b>`}},{data:"value_total",width:"10%",orderable:!0,render:function(t,e,a){return parseFloat(a.value_total).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}},{data:"downloaded",className:"text-center",width:"3%",render:function(t,e,a){let o="";return o="yes"==a.downloaded?`<b class="text-info" data-toggle="tooltip" data-placement="top" title="Última baixa realizada em ${a.updated_at}">Sim</b>`:'<b class="text-danger">Não</b>',o}},{data:"count_undefined",width:"3%",orderable:!0,render:function(t,e,a){return null==a.count_undefined?"":a.count_undefined}},{data:"created_at",width:"9%"},{data:"id",className:"text-center",orderable:!1,width:"10%",render:function(t,e,a){let o="";o+=`<a href="#" data-bs-toggle="modal" data-bs-target="#modal-confirm" data_url="${$("#route_export").val().replace("*",a.id)}" class="get_lote ms-2" data_name="${a.name.substr(12)}" data-toggle="tooltip" data-placement="top" title="Obter lote">\n                            <i class="bi bi-file-earmark-text-fill fs-5"></i>\n                        </a>`;let l=$("#route_destroy").val().replace("*",a.id);return 1==permissionDestroy&&(o+=`<a href="#" data-bs-toggle="modal" data-bs-target="#delete-register" class="destroy ms-2 text-danger" data_id="${a.id}" data_url="${l}" data_name="${a.name.substr(12)}"><i class="bi bi-trash fs-5"></i></a>`),o}}]}),detailRows=[];$("#list tbody").on("click","tr td.details-control",(function(){var t=$(this).closest("tr"),e=table.row(t),a=$.inArray(t.attr("id"),detailRows);if(e.child.isShown())t.removeClass("details"),e.child.hide(),detailRows.splice(a,1);else{t.addClass("details");let o=e.data().count_detail_total,l=null!=e.data().count_proceeds?e.data().count_proceeds:0,n=null!=e.data().value_proceeds?e.data().value_proceeds:0;n=parseFloat(n).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});let r=null!=e.data().count_not_proceeds?e.data().count_not_proceeds:0,d=null!=e.data().value_not_proceeds?e.data().value_not_proceeds:0;d=parseFloat(d).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});let i=null!=e.data().count_correction?e.data().count_correction:0,c=null!=e.data().value_correction?e.data().value_correction:0;c=parseFloat(c).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});let s=null!=e.data().count_not_correction?e.data().count_not_correction:0,u=null!=e.data().value_not_correction?e.data().value_not_correction:0;u=parseFloat(u).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});null!=e.data().count_undefined&&e.data().count_undefined;let b=`<table class="table table-bordered">\n                        <thead class="table-dark">\n                            <tr>\n                                \x3c!--<th>Registros</th>--\x3e\n                                <th colspan="2">Procede</th>\n                                <th colspan="2" data-toggle="tooltip" data-placement="top" title="Qtd. de não procede + incorretos">Não procede <i class="fa fa-info-circle text-info" aria-hidden="true"></i></th>\n                                <th colspan="2" data-toggle="tooltip" data-placement="top" title="Qtd. de não procede + incorretos + corrigidos">Corrigido <i class="fa fa-info-circle text-info" aria-hidden="true"></i></th>\n                                <th colspan="2" data-toggle="tooltip" data-placement="top" title="Qtd. de não procede + incorretos + não corrigidos">Não corrigido <i class="fa fa-info-circle text-info" aria-hidden="true"></i></th>\n                            </tr>\n                        </thead>\n                        <tr>\n                            \x3c!--<td><b>Qtd.:</b><br>${o}</td>--\x3e\n                            <td><b>Qtd.:</b><br>${l}</td>\n                            <td><b>Valor:</b><br>${n}</td>\n                            <td><b>Qtd.:</b><br>${r}</td>\n                            <td><b>Valor:</b><br>${d}</td>\n                            <td><b>Qtd.:</b><br>${i}</td>\n                            <td><b>Valor:</b><br>${c}</td>\n                            <td><b>Qtd.:</b><br>${s}</td>\n                            <td><b>Valor:</b><br>${u}</td>\n                        </tr>\n                    </table>`;e.child(b).show(),-1===a&&detailRows.push(t.attr("id"))}$((function(){$('[data-toggle="tooltip"]').tooltip()}))})),table.on("draw",(function(){$.each(detailRows,(function(t,e){$("#"+e+" td.details-control").trigger("click")}))})),$("#list tbody").on("click",".get_lote",(function(t){t.preventDefault();let e=$(this).attr("data_url"),a=$(this).attr("data_name");$(this);feedsModalConfirm("O lote será enviado para seu email, tudo bem?",a,e),$("#bt-modal-confirm").off("click"),$("#bt-modal-confirm").on("click",(async function(t){await modalConfirmExecute("Aguarde, enviando lote para seu email...","Poof! Em instante chegará na sua caixa de entrada.")}))})),$("#list tbody").on("click",".destroy",(function(t){t.preventDefault();let e=$(this).attr("data_url"),a=$(this).attr("data_name"),o=$(this);feedsDeleteRegister(a,e),$("#modal-bt-delete-register").off("click"),$("#modal-bt-delete-register").on("click",(async function(t){(await modalDeleteExecute(e)).status&&table.row(o.parents("tr")).remove().draw()}))}));
