document.addEventListener("alpine:init",(()=>{Alpine.data("managerFrm",(()=>({modalStatus:new bootstrap.Modal(document.getElementById("modal-status")),data:{_token:document.head.querySelector("meta[name=csrf-token]").content,_method:"post"},loading:!1,buttonLabel:"Enviar",setModalStatus(e,t){document.getElementById("title-modal-status").innerText=e,document.getElementById("desc-status-modal").innerText=t},loadData(){document.querySelector("#order").addEventListener("change",(e=>{let t=e.target.getAttribute("column");this.validateFileHeader("order","Pedido",t)})),document.querySelector("#order_detail").addEventListener("change",(e=>{let t=e.target.getAttribute("column");this.validateFileHeader("order_detail","Pedido detalhe",t)})),document.querySelector("#supplier").addEventListener("change",(e=>{let t=e.target.getAttribute("column");this.validateFileHeader("supplier","Fornecedor",t)}))},validateFileHeader(e,t,o){const a=document.getElementById(e),d=new FileReader;let n=this;d.onload=function(e){const d=e.target.result.split("\r")[0].split(";");""==d[d.length-1].trim()&&d.pop(),d.length!=o&&(n.setModalStatus("Oops! Layout "+t+"!","Layout precisa ter "+o+" colunas."),n.modalStatus.show(),a.value="",a.focus()),$("#frm").valid()},d.readAsText(a.files[0],"ISO-8859-1")},submitData(){if($("#frm").valid()){let e=this;const t=document.querySelector("#order").files[0],o=document.querySelector("#order_detail").files[0],a=document.querySelector("#supplier").files[0],d=new FormData;d.append("order",t),d.append("order_detail",o),d.append("supplier",a),d.append("_token",document.head.querySelector("meta[name=csrf-token]").content),this.buttonLabel="Aguarde, enviando arquivo...",this.loading=!0;let n=new XMLHttpRequest;n.responseType="json",n.onload=function(){200===n.status&&4==n.readyState?e.setModalStatus("Muito bom!","Em breve você receberá o email sobre o processamento!"):e.setModalStatus("Algo errado!","Se persistir, fale com o administrador!"),e.modalStatus.show(),document.getElementById("progress-bar").style.width="0%",document.getElementById("progress-bar").innerHTML="0%",e.loading=!1,e.buttonLabel="Enviar",document.getElementById("order").value="",document.getElementById("order_detail").value="",document.getElementById("supplier").value=""},n.upload.onprogress=function(e){let t=Math.round(e.loaded/e.total*100);document.getElementById("progress-bar").style.width=t+"%",document.getElementById("progress-bar").innerHTML=t+"%"},n.open("POST",document.getElementById("frm").action),n.send(d)}}})))}));
