var table=$("#list").DataTable({responsive:!0,autoWidth:!1,language:{url:"/assets/plugins/datatables/pt_br.json",select:{rows:{_:"Você selecionou %d linhas",0:"Clique na linha para selecionar",1:"Apenas 1 linha foi selecionada"}},buttons:{copyTitle:"Tabela copiada",copySuccess:{_:"%d linhas copiadas",1:"1 linha copiada"}}},order:[[1,"desc"]],searching:!0,ajax:$("#route_list").val(),initComplete:function(t,e){$((function(){$('[data-toggle="tooltip"]').tooltip()}))},columns:[{class:"details-control",orderable:!1,data:null,defaultContent:""},{data:"id",width:"7%"},{data:"reference_date",width:"10%"},{data:"type",width:"15%"},{data:"start_date",width:"18%",orderable:!1,render:function(t,e,a){return`${a.start_date} | ${a.end_date}`}},{data:"user_created.name",width:"18%",render:function(t,e,a){if("display"===e){let t=a.user_created.name.split(" ");return`${t[0]} ${t[t.length-1]}`}return t}},{data:"status",render:function(t,e,a){let d="text-warning";return"complete"==a.status&&(d="text-success"),"error"==a.status&&(d="text-danger"),`<span class="${d}"><b>${a.status}</b></span>`}},{data:"downloaded",className:"text-center",width:"10%",render:function(t,e,a){let d="";return d="yes"==a.downloaded?'<b class="text-info">Sim</b>':'<b class="text-danger">Não</b>',d}},{data:"id",className:"text-center",orderable:!1,width:"15%",render:function(t,e,a){if("display"===e){let t="";if(["warning","complete"].includes(a.status)){t=`<a href="${$("#route_result").val().replace("*",a.id)}" class="ms-2" data-toggle="tooltip" data-placement="top" title="Pegar resultado">\n                                    <i class="bi bi-file-earmark-text-fill fs-5"></i>\n                                </a>`,t+=`<a href="${$("#route_returnfile").val().replace("*",a.id)}" class="ms-2" data-toggle="tooltip" data-placement="top" title="Pegar arquivo de retorno">\n                                    <i class="bi bi-download"></i>\n                                </a>`}let e=$("#route_destroy").val().replace("*",a.id);return t+`<a href="#" data-bs-toggle="modal" data-bs-target="#delete-register" class="destroy ms-2 text-danger" data_id="${a.id}" data_url="${e}" data_name="ID: ${a.id} - ${a.type} - ${a.start_date} | ${a.end_date}" data-toggle="tooltip" data-placement="top" title="Excluir registro"><i class="bi bi-trash fs-5"></i></a>`}return t}}]}),detailRows=[];$("#list tbody").on("click","tr td.details-control",(function(){var t=$(this).closest("tr"),e=table.row(t),a=$.inArray(t.attr("id"),detailRows);if(e.child.isShown())t.removeClass("details"),e.child.hide(),detailRows.splice(a,1);else{t.addClass("details");let d=[],r=null!=e.data().count_total?e.data().count_total:0,s=null!=e.data().count_proceeds?e.data().count_proceeds:0,l=null!=e.data().count_not_proceeds?e.data().count_not_proceeds:0,o=null!=e.data().count_undefined?e.data().count_undefined:0,i=null!=e.data().count_recurrent?e.data().count_recurrent:0,n=[];n.push(`<b>Total CPFs:</b> ${r}`),n.push(`<b>Procede:</b> ${s}`),n.push(`<b>Não procede:</b> ${l}`),n.push(`<b>Sem definição:</b> ${o}`),n.push(`<b>Recorrente:</b> ${i}`),d.push(`<b>D-1 pregão:</b> ${e.data().yesterday_date} | `),d.push(`${n.join(" | ")}<br><br>`),"fato_relevante"==e.data().type&&(d.push(`<b>Fato:</b> ${e.data().name}<br>`),d.push(`<b>Qtd. de dias até o fato:</b> ${e.data().number_days}<br>`)),"encarteiramento"==e.data().type&&d.push(`<b>Qtd. de dias para checar primeira compra:</b> ${e.data().check_days}<br>`),d.push(null!=e.data().description&&""!=e.data().description?`<b>Descrição:</b><br>${e.data().description}<br>`:""),e.child(d.join("")).show(),-1===a&&detailRows.push(t.attr("id"))}})),table.on("draw",(function(){$.each(detailRows,(function(t,e){$("#"+e+" td.details-control").trigger("click")}))})),$("#list tbody").on("click",".destroy",(function(t){t.preventDefault();let e=$(this).attr("data_url"),a=$(this).attr("data_name"),d=$(this);feedsDeleteRegister(a,e),$("#modal-bt-delete-register").off("click"),$("#modal-bt-delete-register").on("click",(async function(t){(await modalDeleteExecute(e)).status&&table.row(d.parents("tr")).remove().draw()}))}));
