document.addEventListener("alpine:init",(()=>{Alpine.data("managerFrm",(()=>({modalStatus:new bootstrap.Modal(document.getElementById("modal-status")),modalConfirm:new bootstrap.Modal(document.getElementById("modal-confirm-indicator")),data:{_token:document.head.querySelector("meta[name=csrf-token]").content,_method:"put"},loading:!1,buttonLabel:"Enviar",loadData(){document.querySelector("#file").addEventListener("change",(t=>{$("#frm").valid()}))},setModalStatus(t,e){document.getElementById("title-modal-status").innerText=t,document.getElementById("desc-status-modal").innerText=e},submitData(){if($("#frm").valid()){this.showBtsConfirm();let t=new FormData,e=$("#file")[0].files;t.append("file",e[0]),t.append("_token",document.head.querySelector("meta[name=csrf-token]").content),this.buttonLabel="Aguarde, enviando arquivo...",this.loading=!0,fetch(document.getElementById("frm").action,{method:"POST",body:t}).then((t=>t.json())).then((t=>{1!=t.status?(this.setModalStatus("Algo errado!","O ID não localizado ou erro no upload do arquivo!"),this.modalStatus.show()):(document.getElementById("modal-confirm-indicator-desc").innerText=`Com a baixa do ID ${t.indicator.id} - ${t.indicator.type}`,this.modalConfirm.show(),this.data.id=t.indicator.id)})).catch((()=>{this.setModalStatus("Error grave! Ao enviar arquivo!","Se persistir, fale com o administrador!"),this.modalStatus.show()})).finally((()=>{this.loading=!1,this.buttonLabel="Enviar",document.getElementById("file").value=""}))}},btCloseConfirm(){},showBtsConfirm(){document.getElementById("confirmIndicatorModalLabel").hidden=!1,document.getElementById("bt-close-confirm-indicator").hidden=!1,document.getElementById("confirm-down-indicator").hidden=!1,document.getElementById("modal-confirm-indicator-desc").innerText="",document.getElementById("return-confirm").innerHTML=""},loadingConfirm(){document.getElementById("confirmIndicatorModalLabel").hidden=!0,document.getElementById("bt-close-confirm-indicator").hidden=!0,document.getElementById("confirm-down-indicator").hidden=!0,document.getElementById("modal-confirm-indicator-desc").innerText="Aguarde, baixando ID..."},uploadStore(){let t=document.getElementById("route_upload_store").value.replace("*",this.data.id);this.loadingConfirm(),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.data)}).then((t=>t.json())).then((t=>{if(1!=t.status)this.setModalStatus("Algo errado!","Não foi possível realizar a baixa do ID."),this.modalStatus.show();else{let e=`Muito bom! ${t.affected_registers} de ${t.total_registers} registros foram baixados com sucesso!`,o=`<ul class="list-unstyled">\n                                    <li><b>Detalhamento da baixa ID ${t.indicator.id} - ${t.indicator.type}:</b></li>\n                                    <li><b>Total CPFs:</b> ${t.indicator.count_total}</li>\n                                    <li><b>Total CPFs procede:</b> ${t.indicator.count_proceeds}</li>\n                                    <li><b>Total CPFs não procede:</b> ${t.indicator.count_not_proceeds}</li>\n                                    <li><b>Total CPFs sem definição:</b> ${t.indicator.count_undefined}</li>\n                                </ul>`;document.getElementById("modal-confirm-indicator-desc").innerText=e,document.getElementById("return-confirm").innerHTML=o}})).catch((()=>{this.setModalStatus("Error grave! Ao baixar ID!","Se persistir, fale com o administrador!"),this.modalStatus.show()})).finally((()=>{document.getElementById("bt-close-confirm-indicator").hidden=!1}))}})))}));
