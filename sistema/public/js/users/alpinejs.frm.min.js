document.addEventListener("alpine:init",(()=>{Alpine.data("managerFrm",(()=>({modalStatus:new bootstrap.Modal(document.getElementById("modal-status")),setModalStatus(e,t){document.getElementById("title-modal-status").innerText=e,document.getElementById("desc-status-modal").innerText=t},search:"",selectall:!1,clicked:!1,selectedRoles:[],allRoles:[],loading:!1,buttonLabel:"Salvar",selected(e){let t=document.getElementById(`role[${e}]`);1==t.checked?this.selectedRoles.push(t.value):this.selectedRoles=arrayRemove(this.selectedRoles,t.value)},loadData(){this.loading=!0,fetch(document.getElementById("route_list").value).then((e=>e.json())).then((e=>{e.data?.id&&(document.getElementById("username").value=e.data.username,document.getElementById("name").value=e.data.name,document.getElementById("email").value=e.data.email,document.getElementById("active").value=e.data.active),this.selectedRoles=arrayColumn(e.data.roles,"name"),this.allRoles=e.allRoles,this.loading=!1,this.feedLi(),document.querySelector("#search").addEventListener("keyup",(e=>{this.search=e.target.value,this.feedLi()}))}))},feedLi(){let e='<li class="list-group-item">\n                            <input @click="allChecked" type="checkbox" id="allChecked">\n                            <label for="allChecked"><b>Todas</b></label>\n                        </li>';this.filteredIRoles.forEach((t=>{if(t.show){let l=this.selectall||this.selectedRoles.indexOf(t.name)>=0&&0==this.clicked?"checked":"";e+=`<li class="list-group-item"> \n                                <input type="checkbox" id="role[${t.name}]" class="input_checkbox"\n                                name="role[${t.name}]" value="${t.name}" \n                                ${l}>\n                            <label id="name" for="role[${t.name}]">${t.name}</label>\n                        </li>`}})),document.getElementById("list_roles").innerHTML=e},allChecked(){this.clicked=!0,this.selectall=!this.selectall,document.querySelectorAll(".input_checkbox").forEach((function(e){e.checked=!!this.selectall}),this)},getChecked(){this.selectedRoles=[],document.querySelectorAll(".input_checkbox").forEach((function(e){e.checked&&this.selectedRoles.push(e.value)}),this)},get filteredIRoles(){return this.allRoles.filter((e=>(e.name.toLowerCase().indexOf(this.search.toLowerCase())>-1?e.show=!0:e.show=!1,e)))},submitData(){if($("#frm").valid()){this.buttonLabel="Aguarde...",this.loading=!0;let e=null!==document.querySelector('input[name="_method"]')?document.querySelector('input[name="_method"]').value:"";this.getChecked();let t={_method:e,_token:document.head.querySelector("meta[name=csrf-token]").content,username:document.getElementById("username").value,name:document.getElementById("name").value,email:document.getElementById("email").value,active:document.getElementById("active").value,password:document.getElementById("password").value,confirm_password:document.getElementById("confirm_password").value,role:this.selectedRoles};fetch(document.getElementById("frm").action,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{1!=e.ok&&this.setModalStatus("Algo errado!","Se persistir, fale com o administrador!"),e.json().then((e=>{this.setModalStatus("Muito bom!","Salvo com sucesso!"),null!=e.redirect&&(window.location.href=e.redirect)}))})).catch((()=>{this.setModalStatus("Error grave!","Se persistir, fale com o administrador!")})).finally((()=>{this.loading=!1,this.buttonLabel="Salvar",this.modalStatus.show()}))}}})))}));
