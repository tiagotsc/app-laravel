document.addEventListener("alpine:init",(()=>{Alpine.data("managerFrm",(()=>({modalStatus:new bootstrap.Modal(document.getElementById("modal-status")),setModalStatus(e,t){document.getElementById("title-modal-status").innerText=e,document.getElementById("desc-status-modal").innerText=t},search:"",data:[],selectall:!1,clicked:!1,selectedPermissions:[],allPermissions:[],loading:!1,buttonLabel:"Salvar",loadData(){this.loading=!0,fetch(document.getElementById("route_list").value).then((e=>e.json())).then((e=>{this.data=e.data,document.getElementById("name").value=null!=e.data?.name?e.data?.name:"",this.selectedPermissions=arrayColumn(e.data.permissions,"name"),this.allPermissions=e.allPermissions,this.loading=!1,this.feedLi(),document.querySelector("#search").addEventListener("keyup",(e=>{this.search=e.target.value,this.feedLi()}))}))},feedLi(){let e='<li class="list-group-item">\n                            <input @click="allChecked" type="checkbox" id="allChecked">\n                            <label for="allChecked"><b>Todas</b></label>\n                        </li>';this.filteredIPermissions.forEach((t=>{if(t.show){let s=this.selectall||this.selectedPermissions.indexOf(t.name)>=0&&0==this.clicked?"checked":"";e+=`<li class="list-group-item"> \n                                <input type="checkbox" id="permission[${t.name}]" class="input_checkbox"\n                                name="permission[${t.name}]" value="${t.name}" \n                                ${s}>\n                            <label id="name" for="permission[${t.name}]">${t.name}</label>\n                        </li>`}})),document.getElementById("list_permission").innerHTML=e},allChecked(){this.clicked=!0,this.selectall=!this.selectall,document.querySelectorAll(".input_checkbox").forEach((function(e){e.checked=!!this.selectall}),this)},getChecked(){this.selectedPermissions=[],document.querySelectorAll(".input_checkbox").forEach((function(e){e.checked&&this.selectedPermissions.push(e.value)}),this)},get filteredIPermissions(){return this.allPermissions.filter((e=>(e.name.toLowerCase().indexOf(this.search.toLowerCase())>-1?e.show=!0:e.show=!1,e)))},submitData(){if($("#frm").valid()){this.buttonLabel="Aguarde...",this.loading=!0;let e=null!==document.querySelector('input[name="_method"]')?document.querySelector('input[name="_method"]').value:"";this.getChecked(),this.data.permission=this.selectedPermissions,this.data._method=e,this.data._token=document.head.querySelector("meta[name=csrf-token]").content,this.data.name=document.getElementById("name").value,fetch(document.getElementById("frm").action,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.data)}).then((e=>{1!=e.ok&&this.setModalStatus("Algo errado!","Se persistir, fale com o administrador!"),e.json().then((e=>{this.setModalStatus("Muito bom!","Salvo com sucesso!"),null!=e.redirect&&(window.location.href=e.redirect)}))})).catch((()=>{this.setModalStatus("Error grave!","Se persistir, fale com o administrador!")})).finally((()=>{this.loading=!1,this.buttonLabel="Salvar",this.modalStatus.show()}))}}})))}));
